<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.astro.dao.ProductDao">

    <insert id="insertProduct" parameterType="Product" useGeneratedKeys="true" keyProperty="productId"
            keyColumn="product_id">
	  INSERT INTO
		tb_product(product_name,product_desc,img_addr,
		normal_price,promotion_price,priority,create_time,
		last_edit_time,enable_status,product_category_id,
		shop_id)
		VALUES
		(#{productName},#{productDesc},#{imgAddr},
		#{normalPrice},#{promotionPrice},#{priority},#{createTime},
		#{lastEditTime},#{enableStatus},#{productCategory.productCategoryId},
		#{shop.shopId})
    </insert>

    <select id="queryProductList" resultType="Product">
        SELECT
        product_name,product_id,product_desc,img_addr,normal_price,promotion_price,priority,create_time,
        last_edit_time,enable_status,product_category_id,shop_id
        FROM
        tb_product
        <where>
            <if test="productCondition.shop != null and productCondition.shop.shopId != null">
                shop_id = #{productCondition.shop.shopId}
            </if>
            <if test="productCondition.productCategory != null and productCondition.productCategory.productCategoryId != null">
                and product_category_id = #{productCondition.productCategory.productCategoryId}
            </if>
            <if test="productCondition.productCategory.productCategoryName!= null">
                and product_name LIKE '%${productCondition.productName}%'
            </if>
            <if test="productCondition.enableStatus != null">
                and enable_status = #{productConditon.enableStatus}
            </if>
        </where>
        ORDER BY
        priority DESC
        LIMIT #{rowIndex},#{pageSize}
    </select>

    <select id="queryProductCount" resultType="int">
        SELECT
        count(1) FROM tb_product
        <where>
            <if test="productCondition.shop != null and productCondition.shop.shopId != null">
                shop_id = #{productCondition.shop.shopId}
            </if>
            <if test="productCondition.productCategory != null and productCondition.productCategory.productCategoryId != null">
                and product_category_id = #{productCondition.productCategory.productCategoryId}
            </if>
            <if test="productCondition.productCategory.productCategoryName!= null">
                and product_name LIKE '%${productCondition.productName}%'
            </if>
            <if test="productCondition.enableStatus != null">
                and enable_status = #{productConditon.enableStatus}
            </if>
        </where>
    </select>

    <update id="updateProductCategoryToNull" parameterType="long">
        UPDATE
        tb_product
        SET product_category_id = NULL
        WHERE product_category_id = #{productCategoryId}
    </update>

</mapper>